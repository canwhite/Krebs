# Subagent ç³»ç»Ÿæ ¸å¿ƒæµç¨‹è¯¦è§£

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
> **åˆ›å»ºæ—¶é—´**: 2026-02-13
> **çŠ¶æ€**: å®Œæ•´

---

## ç›®å½•

1. [ç³»ç»Ÿæ¦‚è§ˆ](#ç³»ç»Ÿæ¦‚è§ˆ)
2. [æ ¸å¿ƒæµç¨‹](#æ ¸å¿ƒæµç¨‹)
3. [æ•°æ®æµè®¾è®¡](#æ•°æ®æµè®¾è®¡)
4. [å®‰å…¨æ§åˆ¶æœºåˆ¶](#å®‰å…¨æ§åˆ¶æœºåˆ¶)
5. [å…³é”®æ–‡ä»¶](#å…³é”®æ–‡ä»¶)
6. [å®ç°çŠ¶æ€](#å®ç°çŠ¶æ€)
7. [éªŒè¯æµ‹è¯•](#éªŒè¯æµ‹è¯•)

---

## ç³»ç»Ÿæ¦‚è§ˆ

Subagent ç³»ç»Ÿå…è®¸ä¸» Agent åœ¨éš”ç¦»ä¼šè¯ä¸­ç”Ÿæˆåå°å­ä»£ç†è¿è¡Œï¼Œæ‰§è¡Œå¤æ‚æˆ–è€—æ—¶çš„ä»»åŠ¡ï¼Œå¹¶å°†ç»“æœé€šçŸ¥å›è¯·æ±‚è€…ã€‚

**æ ¸å¿ƒç‰¹æ€§**ï¼š
- ğŸ”„ **å¹¶è¡Œå¤„ç†**: åŒæ—¶æ‰§è¡Œå¤šä¸ªç‹¬ç«‹ä»»åŠ¡
- ğŸ”’ **èµ„æºéš”ç¦»**: é¿å…é•¿ä»»åŠ¡é˜»å¡ä¸»ä¼šè¯
- ğŸ¯ **ä¸“ä¸šåŒ–æ‰§è¡Œ**: ä½¿ç”¨ç‰¹å®šé…ç½®çš„ Agent æ‰§è¡Œç‰¹å®šä»»åŠ¡
- ğŸ“¬ **åå°å¤„ç†**: å¼‚æ­¥æ‰§è¡Œä¸éœ€è¦ç«‹å³å“åº”çš„ä»»åŠ¡

---

## æ ¸å¿ƒæµç¨‹

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  SUBAGENT ç³»ç»Ÿæ ¸å¿ƒæµç¨‹                               â•‘
â•‘                                                                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### é˜¶æ®µ 1: ç”¨æˆ·å‘èµ·å¯¹è¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·å‘èµ·å¯¹è¯                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ç”¨æˆ·: "è¯·å¸®æˆ‘åˆ†æè¿™ä¸ªé¡¹ç›®çš„ä»£ç è´¨é‡"
      â”‚
      â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  UI/Client  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â†“
  POST /api/chat { messages: [{ role: "user", content: "..." }] }
      â”‚
      â†“
```

### é˜¶æ®µ 2: HTTP æœåŠ¡å™¨æ¥æ”¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HTTP æœåŠ¡å™¨æ¥æ”¶                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ HTTP Server  â”‚  æ¥æ”¶è¯·æ±‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â†“
  è°ƒç”¨ ChatService.process()
      â”‚
      â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ChatService  â”‚  è·å– Agent
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â†“
  agentManager.getAgent(agentId)
      â”‚
      â†“
```

### é˜¶æ®µ 3: Agent å¤„ç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Agent å¤„ç†                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   Agent    â”‚  å‡†å¤‡å¤„ç†
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                  â”‚
  â”‚ 1. åŠ è½½ä¼šè¯å†å²   â”‚ â†’ loadSession(sessionKey)
  â”‚ 2. æ„å»ºæ¶ˆæ¯åˆ—è¡¨    â”‚ â†’ messages + systemPrompt
  â”‚ 3. å‡†å¤‡å·¥å…·åˆ—è¡¨      â”‚ â†“
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ AgentDeps (ä¾èµ–æ³¨å…¥)     â”‚
  â”‚ - provider: LLMProvider     â”‚
  â”‚ - tools: Tool[]           â”‚ â† spawn_subagent åœ¨è¿™é‡Œï¼
  â”‚ - toolConfig: ToolConfig   â”‚
  â”‚ - skillsManager            â”‚
  â”‚ - memoryService           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â†“
```

### é˜¶æ®µ 4: è°ƒç”¨ LLM API

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è°ƒç”¨ LLM API                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  provider.chat(messages, { tools: [...] })
      â”‚
      â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ LLM API   â”‚  Anthropic/OpenAI/DeepSeek
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â†“
  LLM å†³ç­–: "æˆ‘éœ€è¦åˆ›å»ºä¸€ä¸ª Subagent æ¥å¤„ç†è¿™ä¸ªä»»åŠ¡"
      â”‚
      â†“
  è¿”å› tool_calls: [
    { name: "spawn_subagent", arguments: { task: "åˆ†æä»£ç è´¨é‡" } }
  ]
      â”‚
      â†“
```

### é˜¶æ®µ 5: å·¥å…·æ‰§è¡Œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å·¥å…·æ‰§è¡Œ (spawn-subagent.ts)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  spawn_subagent.execute({ task: "åˆ†æä»£ç è´¨é‡" })
      â”‚
      â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 1. è·å–ä¾èµ–           â”‚
  â”‚    - getSessionKey()     â”‚ â†’ è¿”å› "user:123"
  â”‚    - getDisplayName()  â”‚ â†’ è¿”å› "user:123"
  â”‚    - getRegistry()       â”‚ â†’ è¿”å› SubagentRegistry
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 2. ç”Ÿæˆå”¯ä¸€ ID       â”‚
  â”‚    - runId = uuid()      â”‚ â†’ "abc-123-def-456"
  â”‚    - taskHash = sha256()  â”‚ â†’ "def456"
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 3. æ„å»ºå­ä¼šè¯é”®     â”‚
  â”‚ childSessionKey =          â”‚ â†’ "subagent:abc-123:def456"
  â”‚   "subagent:" + runId + ":" + taskHash
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 4. æ³¨å†Œåˆ° Registry    â”‚
  â”‚    registry.register({   â”‚
  â”‚      runId,               â”‚
  â”‚      childSessionKey,       â”‚
  â”‚      requesterSessionKey,   â”‚
  â”‚      task,                â”‚ â†’ SubagentRunRecord
  â”‚      cleanup,            â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚      ...                  â”‚   â”‚ åˆ›å»ºæˆåŠŸï¼     â”‚
  â”‚    })                   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â†“
  è¿”å›ç»“æœ: {
    success: true,
    data: {
      runId: "abc-123-def-456",
      childSessionKey: "subagent:abc-123:def456",
      status: "registered",
      message: "Subagent abc-123 å·²åˆ›å»º..."
    }
  }
```

### é˜¶æ®µ 6: è¿”å›ç»™ LLM å’Œç”¨æˆ·

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¿”å›ç»™ LLM å’Œç”¨æˆ·                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  spawn_subagent è¿”å› â†’ tool_result
      â”‚
      â†“
  LLM æ”¶åˆ° tool_result
      â”‚
      â†“
  LLM ç”Ÿæˆå“åº”: "æˆ‘å·²ç»åˆ›å»ºäº†ä¸€ä¸ª Subagent abc-123 æ¥åˆ†æä»£ç è´¨é‡ã€‚
                   å®ƒä¼šåœ¨åå°è¿è¡Œï¼Œå®Œæˆåä¼šé€šçŸ¥æ‚¨ã€‚"
      â”‚
      â†“
  è¿”å›ç»™ç”¨æˆ·
      â”‚
      â†“
  ã€æ³¨æ„ã€‘æ­¤æ—¶ Subagent è¿˜æ²¡æœ‰è¿è¡Œï¼åªæ˜¯æ³¨å†Œäº†è®°å½•ã€‚
```

### é˜¶æ®µ 7: Subagent æ‰§è¡Œï¼ˆåå°å¼‚æ­¥ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Subagent æ‰§è¡Œï¼ˆåå°å¼‚æ­¥ï¼‰                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Subagent æ‰§è¡Œå™¨       â”‚ â† ç‹¬ç«‹çš„è¿›ç¨‹/ä»»åŠ¡ï¼
  â”‚ (éœ€è¦å®ç°)          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â†“
  1. åˆ›å»ºæ–°ä¼šè¯
     sessionKey = "subagent:abc-123:def456"
      â†“
  2. åˆå§‹åŒ– Agent
     new Agent(subagentConfig, agentDeps)
      â†“
  3. æ‰§è¡Œä»»åŠ¡
     agent.process("åˆ†æä»£ç è´¨é‡", sessionKey)
      â†“
  4. è°ƒç”¨å·¥å…·
     subagent å¯ä»¥ä½¿ç”¨å·¥å…·ï¼ˆå—é™åˆ¶ï¼‰
      â†“
  5. å®Œæˆä»»åŠ¡
     ç”Ÿæˆç»“æœ
```

### é˜¶æ®µ 8: çŠ¶æ€æ›´æ–°å’Œé€šçŸ¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ çŠ¶æ€æ›´æ–°å’Œé€šçŸ¥                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Subagent å®Œæˆ
      â”‚
      â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 1. æ›´æ–° Registry       â”‚
  â”‚    registry.update({    â”‚
  â”‚      runId,              â”‚
  â”‚      outcome: {           â”‚
  â”‚        status: "completed",â”‚
  â”‚        result: "..."     â”‚ â†’ çŠ¶æ€æ›´æ–°
  â”‚      }                  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 2. è§¦å‘é€šçŸ¥           â”‚
  â”‚    announce.announce(record)
  â”‚       â†“                 â”‚
  â”‚    æ ¼å¼åŒ–é€šçŸ¥æ¶ˆæ¯        â”‚ â†’ "ğŸ“¢ **ä»£ç åˆ†æ**"
  â”‚    â†“                 â”‚    "âœ… å®Œæˆï¼šå‘ç° 3 ä¸ªé—®é¢˜"
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 3. å‘é€åˆ°åŸä¼šè¯       â”‚
  â”‚    notificationHandler({
  â”‚      sessionKey: "user:123",    â”‚ â† åŸç”¨æˆ·ä¼šè¯
  â”‚      content: "..."          â”‚
  â”‚    })                         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â†“
  ç”¨æˆ·åœ¨åŸä¼šè¯æ”¶åˆ°é€šçŸ¥
      â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ UI æ˜¾ç¤ºæ–°æ¶ˆæ¯           â”‚
  â”‚ "ğŸ“¢ **ä»£ç åˆ†æ**"        â”‚
  â”‚ "âœ… å®Œæˆï¼šå‘ç° 3 ä¸ªé—®é¢˜" â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ•°æ®æµè®¾è®¡

### 1. ä¼šè¯é”®è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸»ä¼šè¯: user:123                   â”‚
â”‚ å­ä¼šè¯: subagent:abc-123:def456      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å®Œå…¨éš”ç¦»ï¼ä¸åŒçš„æ¶ˆæ¯å†å²ï¼
```

### 2. å·¥å…·åˆ—è¡¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /api/tools è¿”å›çš„å·¥å…·åˆ—è¡¨:           â”‚
â”‚                                          â”‚
â”‚ 1. bash                                 â”‚
â”‚ 2. read_file                            â”‚
â”‚ 3. write_file                            â”‚
â”‚ 4. edit_file                             â”‚
â”‚ 5. web_search                            â”‚
â”‚ 6. web_fetch                             â”‚
â”‚ 7. spawn_subagent  â† æ–°å¢ï¼        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
LLM å¯ä»¥çœ‹åˆ°å¹¶è°ƒç”¨ spawn_subagent
```

### 3. æ³¨å†Œè¡¨ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SubagentRegistry (å†…å­˜ä¸­)                  â”‚
â”‚                                          â”‚
â”‚ Map<runId, SubagentRunRecord>          â”‚
â”‚                                          â”‚
â”‚ - abc-123: {                         â”‚
â”‚     runId, task, status, ...            â”‚
â”‚   }                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. æŒä¹…åŒ–å­˜å‚¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ–‡ä»¶ç³»ç»Ÿ                               â”‚
â”‚                                          â”‚
â”‚ ./data/subagents/                      â”‚
â”‚   â”œâ”€â”€ registry.jsonl (è¿è¡Œè®°å½•)     â”‚
â”‚   â””â”€â”€ sessions/                        â”‚
â”‚       â””â”€â”€ subagent_*.md (ä¼šè¯)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å®‰å…¨æ§åˆ¶æœºåˆ¶

### 1. å¹¶å‘æ§åˆ¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ maxConcurrent = 5                â”‚
â”‚                                  â”‚
â”‚ æ£€æŸ¥: activeCount < maxConcurrentâ”‚
â”‚                                  â”‚
â”‚ å¦‚æœ â‰¥ 5ï¼Œæ‹’ç»åˆ›å»ºæ–°çš„ Subagent  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Agent ç™½åå•

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ allowedAgents: ["*"]            â”‚ â†’ å…è®¸æ‰€æœ‰
â”‚ allowedAgents: ["agent-a"]      â”‚ â†’ åªå…è®¸ agent-a
â”‚ allowedAgents: ["agent-a", "agent-b"] â”‚ â†’ åªå…è®¸è¿™ä¸¤ä¸ª
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. å·¥å…·é™åˆ¶ï¼ˆå·²å®šä¹‰ï¼Œéœ€è¦å®ç°æ‰§è¡Œå™¨ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DEFAULT_SUBAGENT_TOOL_DENY:      â”‚
â”‚ - sessions_list, sessions_spawn â”‚ â†’ ç¦æ­¢ä¼šè¯ç®¡ç†
â”‚ - gateway, agents_list          â”‚ â†’ ç¦æ­¢ç³»ç»Ÿç®¡ç†
â”‚ - memory_search, memory_save     â”‚ â†’ ç¦æ­¢è®°å¿†æ±¡æŸ“
â”‚ - system_info, process_control  â”‚ â†’ ç¦æ­¢ç³»ç»Ÿæ§åˆ¶
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. è¶…æ—¶æ§åˆ¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ runTimeoutSeconds: 300           â”‚ â†’ 5 åˆ†é’Ÿè¶…æ—¶
â”‚                                  â”‚
â”‚ è¶…æ—¶åè‡ªåŠ¨æ ‡è®°ä¸º timeout      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5. æ¸…ç†ç­–ç•¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ cleanup: "delete"                â”‚ â†’ å®Œæˆååˆ é™¤ä¼šè¯
â”‚ cleanup: "keep"                  â”‚ â†’ ä¿ç•™ä¼šè¯ä¾›æŸ¥çœ‹
â”‚                                  â”‚
â”‚ archiveAfterMinutes: 10080         â”‚ â†’ 7 å¤©åå½’æ¡£
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å…³é”®æ–‡ä»¶

### 1. ç±»å‹å®šä¹‰

```
src/agent/subagent/types.ts
â”œâ”€ SubagentRunRecord      # è¿è¡Œè®°å½•
â”œâ”€ SubagentConfig         # é…ç½®
â”œâ”€ SubagentToolsConfig    # å·¥å…·è¿‡æ»¤
â””â”€ SubagentSkillsConfig    # æŠ€èƒ½è¿‡æ»¤
```

### 2. æ³¨å†Œè¡¨

```
src/agent/subagent/registry.ts
â”œâ”€ register()    # æ³¨å†Œ Subagent
â”œâ”€ get()         # æŸ¥è¯¢ Subagent
â”œâ”€ update()      # æ›´æ–°çŠ¶æ€
â”œâ”€ delete()      # åˆ é™¤ Subagent
â””â”€ list()        # åˆ—å‡ºæ‰€æœ‰
```

### 3. å­˜å‚¨å±‚

```
src/agent/subagent/store.ts
â”œâ”€ saveSession()    # ä¿å­˜ä¼šè¯
â”œâ”€ loadSession()    # åŠ è½½ä¼šè¯
â””â”€ deleteSession()  # åˆ é™¤ä¼šè¯
```

### 4. é€šçŸ¥ç³»ç»Ÿ

```
src/agent/subagent/announce.ts
â”œâ”€ announce()      # å‘é€é€šçŸ¥
â””â”€ setNotificationHandler()  # è®¾ç½®å¤„ç†å™¨
```

### 5. å·¥å…·å®ç°

```
src/agent/tools/spawn-subagent.ts
â””â”€ createSpawnSubagentTool()  # å·¥å‚å‡½æ•°
```

### 6. AgentManager é›†æˆ

```
src/agent/core/manager.ts
â”œâ”€ subagentRegistry?: SubagentRegistry
â”œâ”€ getSubagentRegistry()
â””â”€ start() æ—¶è°ƒç”¨ restore()
```

---

## å®ç°çŠ¶æ€

### âœ… å·²å®Œæˆï¼ˆå¯ç”¨ï¼‰

```
âœ… SubagentRegistry å®Œæ•´å®ç°
âœ… SubagentStore å®Œæ•´å®ç°
âœ… SubagentAnnounce å®Œæ•´å®ç°
âœ… spawn_subagent å·¥å…·å®ç°
âœ… AgentManager é›†æˆå®Œæˆ
âœ… ç±»å‹å®šä¹‰å®Œæ•´
âœ… å•å…ƒæµ‹è¯•è¦†ç›–ï¼ˆ16 ä¸ªæµ‹è¯•ï¼‰
```

### ğŸ”œ å¾…å®ç°ï¼ˆéœ€è¦ Subagent æ‰§è¡Œå™¨ï¼‰

```
ğŸ”œ Subagent æ‰§è¡Œå™¨ï¼ˆå®é™…è¿è¡Œä»»åŠ¡çš„ç»„ä»¶ï¼‰
ğŸ”œ å·¥å…·è¿‡æ»¤æœºåˆ¶ï¼ˆSubagentToolFilterï¼‰
ğŸ”œ æŠ€èƒ½ç»§æ‰¿æœºåˆ¶ï¼ˆSubagentSkillsManagerï¼‰
ğŸ”œ Lane è°ƒåº¦é›†æˆï¼ˆåå°ä»»åŠ¡è°ƒåº¦ï¼‰
ğŸ”œ WebSocket é€šçŸ¥é›†æˆï¼ˆå®æ—¶é€šçŸ¥ï¼‰
```

---

## éªŒè¯æµ‹è¯•

### 1ï¸âƒ£ å¿«é€ŸéªŒè¯ï¼ˆ1 åˆ†é’Ÿï¼‰

```bash
node test/quick-subagent-test.ts
```

éªŒè¯ Registry åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤

### 2ï¸âƒ£ æ£€æŸ¥å·¥å…·åˆ—è¡¨ï¼ˆ30 ç§’ï¼‰

```bash
curl http://localhost:3000/api/tools
```

ç¡®è®¤ spawn_subagent åœ¨åˆ—è¡¨ä¸­

### 3ï¸âƒ£ è¿è¡Œå•å…ƒæµ‹è¯•ï¼ˆ10 ç§’ï¼‰

```bash
npm test -- test/agent/subagent/registry.test.ts
```

16 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

### 4ï¸âƒ£ ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆå¯é€‰ï¼Œ15 åˆ†é’Ÿï¼‰

```
å¯åŠ¨ Server
åœ¨ UI ä¸­æµ‹è¯• spawn_subagent å·¥å…·
è§‚å¯Ÿ Subagent åˆ›å»ºå’Œæ‰§è¡Œ
```

---

## æ€»ç»“

### âœ… æ ¸å¿ƒåŸºç¡€è®¾æ–½: 100% å®Œæˆ

- ç±»å‹å®šä¹‰ âœ…
- æ³¨å†Œè¡¨ âœ…
- å­˜å‚¨å±‚ âœ…
- é€šçŸ¥ç³»ç»Ÿ âœ…
- å·¥å…·é›†æˆ âœ…
- AgentManager é›†æˆ âœ…
- å•å…ƒæµ‹è¯• âœ…

### ğŸ¯ ä¸‹ä¸€æ­¥: å®ç° Subagent æ‰§è¡Œå™¨

- åˆ›å»ºç‹¬ç«‹ Agent è¿è¡Œçš„ç»„ä»¶
- å®ç°å·¥å…·å’ŒæŠ€èƒ½è¿‡æ»¤
- é›†æˆåˆ° Lane è°ƒåº¦ç³»ç»Ÿ

### ğŸš€ å½“å‰å¯ç”¨åŠŸèƒ½

- âœ… spawn_subagent å·¥å…·å¯ä»¥è°ƒç”¨
- âœ… Subagent æ³¨å†Œåˆ° Registry
- âœ… å¯ä»¥æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤ Subagent
- âœ… æ•°æ®æŒä¹…åŒ–æ­£å¸¸å·¥ä½œ
- âœ… å¹¶å‘æ§åˆ¶å’Œå®‰å…¨é™åˆ¶å·²å°±ä½

---

**æ–‡æ¡£ç»´æŠ¤**: æœ¬æ–‡æ¡£åº”éš Subagent ç³»ç»Ÿæ¼”è¿›åŒæ­¥æ›´æ–°
