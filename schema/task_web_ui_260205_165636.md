# Task: ä¸º Krebs é¡¹ç›®æ·»åŠ  Web ç•Œé¢

**ä»»åŠ¡ID**: task_web_ui_260205_165636
**åˆ›å»ºæ—¶é—´**: 2026-02-05
**çŠ¶æ€**: è¿›è¡Œä¸­
**ç›®æ ‡**: å‚è€ƒ openclaw-cn-ds é¡¹ç›®ï¼Œä¸º Krebs æ·»åŠ  Web ç•Œé¢ï¼Œæ”¯æŒ Chatã€Tool æ˜¾ç¤ºå’Œ Skills æ˜¾ç¤º

## æœ€ç»ˆç›®æ ‡
åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„ Web ç•Œé¢ï¼Œæä¾›ï¼š
- ğŸ“ **Chat åŠŸèƒ½**: ä¸ Agent è¿›è¡Œå®æ—¶å¯¹è¯
- ğŸ› ï¸ **Tool æ˜¾ç¤º**: å±•ç¤ºå·¥å…·è°ƒç”¨å’Œæ‰§è¡Œç»“æœ
- âš¡ **Skills æ˜¾ç¤º**: å±•ç¤ºå¯ç”¨æŠ€èƒ½å’ŒçŠ¶æ€
- ğŸ¨ **ç°ä»£ UI**: ä½¿ç”¨ Lit Web Components + Vite

## å‚è€ƒé¡¹ç›®åˆ†æ

### openclaw-cn-ds UI æ¶æ„
- **UI æ¡†æ¶**: Lit (Web Components)
- **æ„å»ºå·¥å…·**: Vite 7.3.1
- **æ ·å¼**: åŸç”Ÿ CSS + dark/light ä¸»é¢˜
- **ä¸»è¦ä¾èµ–**:
  - `lit` ^3.3.2 - Web Components æ¡†æ¶
  - `marked` ^17.0.1 - Markdown æ¸²æŸ“
  - `dompurify` ^3.3.1 - XSS é˜²æŠ¤

### ç›®å½•ç»“æ„
```
ui/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.ts           # å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ styles.css        # å…¨å±€æ ·å¼
â”‚   â””â”€â”€ ui/
â”‚       â”œâ”€â”€ app.ts                # ä¸»åº”ç”¨ç»„ä»¶
â”‚       â”œâ”€â”€ app-chat.ts           # èŠå¤©åŠŸèƒ½
â”‚       â”œâ”€â”€ tool-display.ts       # å·¥å…·æ˜¾ç¤º
â”‚       â”œâ”€â”€ chat/                 # èŠå¤©ç›¸å…³ç»„ä»¶
â”‚       â”œâ”€â”€ views/                # å„ç§è§†å›¾
â”‚       â””â”€â”€ controllers/          # æ§åˆ¶å™¨
â”œâ”€â”€ index.html
â”œâ”€â”€ package.json
â”œâ”€â”€ vite.config.ts
â””â”€â”€ tsconfig.json
```

## æ‹†è§£æ­¥éª¤

### 1. é¡¹ç›®åˆå§‹åŒ–
- [x] 1.1 åˆ›å»º UI ç›®å½•ç»“æ„
- [x] 1.2 åˆå§‹åŒ– package.json
- [x] 1.3 é…ç½® Vite
- [x] 1.4 é…ç½® TypeScript

### 2. æ ¸å¿ƒç»„ä»¶å¼€å‘
- [x] 2.1 åˆ›å»ºä¸»åº”ç”¨ç»„ä»¶ (`krebs-app.ts`)
- [x] 2.2 åˆ›å»ºå¸ƒå±€ç»„ä»¶ï¼ˆHeader, Sidebar, Mainï¼‰
- [x] 2.3 å®ç°ä¸»é¢˜ç³»ç»Ÿï¼ˆdark/light modeï¼‰

### 3. Chat åŠŸèƒ½
- [x] 3.1 åˆ›å»ºèŠå¤©ç•Œé¢ç»„ä»¶ (`krebs-chat.ts`)
- [x] 3.2 å®ç°æ¶ˆæ¯åˆ—è¡¨æ˜¾ç¤º
- [x] 3.3 å®ç°æ¶ˆæ¯è¾“å…¥æ¡†
- [x] 3.4 é›†æˆ Markdown æ¸²æŸ“
- [ ] 3.5 å®ç° WebSocket é€šä¿¡ï¼ˆå¾…åç»­æ·»åŠ ï¼‰

### 4. Tool æ˜¾ç¤º
- [x] 4.1 åˆ›å»ºå·¥å…·è°ƒç”¨å¡ç‰‡ç»„ä»¶
- [x] 4.2 å®ç°å·¥å…·æ‰§è¡ŒçŠ¶æ€æ˜¾ç¤º
- [x] 4.3 å®ç°å·¥å…·ç»“æœå±•ç¤ºï¼ˆæ”¯æŒ JSONã€æ–‡æœ¬ã€ä»£ç å—ï¼‰

### 5. Skills æ˜¾ç¤º
- [x] 5.1 åˆ›å»ºæŠ€èƒ½åˆ—è¡¨ç»„ä»¶
- [x] 5.2 å®ç°æŠ€èƒ½è¯¦æƒ…å±•ç¤º
- [x] 5.3 å®ç°æŠ€èƒ½å¯ç”¨/ç¦ç”¨æ§åˆ¶

### 6. åç«¯é›†æˆ
- [x] 6.1 æ‰©å±• Gateway æ·»åŠ é™æ€æ–‡ä»¶æœåŠ¡
- [x] 6.2 åˆ›å»º API è·¯ç”±ï¼ˆ/api/tools, /api/skillsï¼‰
- [x] 6.3 å®ç°ç®€åŒ–èŠå¤© API

### 7. æµ‹è¯•ä¸ä¼˜åŒ–
- [ ] 7.1 åŠŸèƒ½æµ‹è¯•
- [ ] 7.2 å“åº”å¼å¸ƒå±€ä¼˜åŒ–
- [ ] 7.3 æ€§èƒ½ä¼˜åŒ–

## å½“å‰è¿›åº¦

### æ­£åœ¨è¿›è¡Œ: åŸºç¡€åŠŸèƒ½å·²å®Œæˆ
å·²å®Œæˆæ ¸å¿ƒ UI ç»„ä»¶å’Œåç«¯é›†æˆï¼Œåˆ›å»ºæ–‡æ¡£å’Œæµ‹è¯•æŒ‡å—

### å·²å®Œæˆçš„å·¥ä½œ

#### âœ… UI å‰ç«¯
1. **é¡¹ç›®ç»“æ„**
   - åˆ›å»ºå®Œæ•´çš„ç›®å½•ç»“æ„ï¼ˆui/src/ui/{chat,components,views,controllers}ï¼‰
   - é…ç½® Vite å’Œ TypeScript
   - åˆ›å»º package.json å’Œä¾èµ–é…ç½®

2. **æ ¸å¿ƒç»„ä»¶**
   - `krebs-app.ts` - ä¸»åº”ç”¨ç»„ä»¶ï¼ŒåŒ…å«å¸ƒå±€ï¼ˆHeader, Sidebar, Mainï¼‰
   - `krebs-chat.ts` - èŠå¤©ç•Œé¢ç»„ä»¶ï¼Œæ”¯æŒæ¶ˆæ¯åˆ—è¡¨å’Œè¾“å…¥
   - `krebs-tool-card.ts` - å·¥å…·å¡ç‰‡ç»„ä»¶ï¼Œå±•ç¤ºå·¥å…·è°ƒç”¨çŠ¶æ€å’Œç»“æœ
   - `krebs-tools-list.ts` - å·¥å…·åˆ—è¡¨ç»„ä»¶
   - `krebs-skills-list.ts` - æŠ€èƒ½åˆ—è¡¨ç»„ä»¶ï¼Œæ”¯æŒå¯ç”¨/ç¦ç”¨

3. **æ ·å¼ç³»ç»Ÿ**
   - CSS Variables ä¸»é¢˜ç³»ç»Ÿ
   - Dark/Light æ¨¡å¼è‡ªåŠ¨åˆ‡æ¢
   - å“åº”å¼å¸ƒå±€
   - åŠ¨ç”»æ•ˆæœï¼ˆtyping indicator, pulse ç­‰ï¼‰

#### âœ… åç«¯é›†æˆ
1. **Gateway æ‰©å±•** (src/gateway/server/http-server.ts)
   - é™æ€æ–‡ä»¶æœåŠ¡ï¼ˆexpress.staticï¼‰
   - SPA fallback è·¯ç”±
   - æ–°å¢ API è·¯ç”±ï¼š
     - `GET /api/health` - å¥åº·æ£€æŸ¥
     - `GET /api/tools` - è·å–å·¥å…·åˆ—è¡¨
     - `GET /api/skills` - è·å–æŠ€èƒ½åˆ—è¡¨
     - `PATCH /api/skills/:skillId` - åˆ‡æ¢æŠ€èƒ½çŠ¶æ€
     - `POST /api/chat` - ç®€åŒ–çš„èŠå¤© APIï¼ˆç›´æ¥æ¥å—æ¶ˆæ¯ï¼‰

2. **æ–°å¢å¤„ç†æ–¹æ³•**
   - `handleGetTools()` - ä» AgentManager è·å–å·¥å…·
   - `handleGetSkills()` - ä» SkillsManager è·å–æŠ€èƒ½
   - `handleToggleSkill()` - å¯ç”¨/ç¦ç”¨æŠ€èƒ½

#### âœ… æ–‡æ¡£
- åˆ›å»º `ui/README.md` - å®Œæ•´çš„ä½¿ç”¨æ–‡æ¡£

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨
1. å®‰è£…ä¾èµ–å¹¶æµ‹è¯•å¼€å‘ç¯å¢ƒ
2. æ„å»º UI å¹¶æµ‹è¯•ä¸åç«¯çš„é›†æˆ
3. æ·»åŠ  WebSocket å®æ—¶é€šä¿¡ï¼ˆå¯é€‰ï¼‰
4. å®Œå–„é”™è¯¯å¤„ç†å’Œè¾¹ç¼˜æƒ…å†µ

## æŠ€æœ¯é€‰å‹

### UI æ¡†æ¶: Lit Web Components
**ç†ç”±**:
- è½»é‡çº§ï¼ˆ~10KBï¼‰
- åŸç”Ÿ Web Componentsï¼Œæ— æ¡†æ¶é”å®š
- ä¼˜ç§€çš„ TypeScript æ”¯æŒ
- å£°æ˜å¼æ¨¡æ¿ï¼ˆç±»ä¼¼ React JSXï¼‰
- å‚è€ƒé¡¹ç›®å·²éªŒè¯

### æ„å»ºå·¥å…·: Vite
**ç†ç”±**:
- å¿«é€Ÿçš„çƒ­æ›´æ–°
- åŸç”Ÿ ESM æ”¯æŒ
- å¼€ç®±å³ç”¨çš„ TypeScript æ”¯æŒ
- ä¸å‚è€ƒé¡¹ç›®ä¸€è‡´

### æ ·å¼æ–¹æ¡ˆ: åŸç”Ÿ CSS + CSS Variables
**ç†ç”±**:
- ç®€å•ç›´æ¥ï¼Œæ— å­¦ä¹ æˆæœ¬
- æ˜“äºä¸»é¢˜åˆ‡æ¢ï¼ˆdark/light modeï¼‰
- ä¸å‚è€ƒé¡¹ç›®ä¸€è‡´

## API è®¾è®¡

### Gateway æ‰©å±•
```typescript
// æ–°å¢è·¯ç”±
GET  /ui/*           â†’ é™æ€æ–‡ä»¶æœåŠ¡ï¼ˆUI ç•Œé¢ï¼‰
WS   /ws/chat        â†’ WebSocket èŠå¤©è¿æ¥
GET  /api/tools      â†’ è·å–å¯ç”¨å·¥å…·åˆ—è¡¨
GET  /api/skills     â†’ è·å–å¯ç”¨æŠ€èƒ½åˆ—è¡¨
POST /api/chat       â†’ å‘é€æ¶ˆæ¯ï¼ˆHTTP fallbackï¼‰
```

### WebSocket æ¶ˆæ¯æ ¼å¼
```typescript
// å®¢æˆ·ç«¯ â†’ æœåŠ¡å™¨
{
  type: "message",
  content: "ç”¨æˆ·è¾“å…¥",
  sessionId: "session-id"
}

// æœåŠ¡å™¨ â†’ å®¢æˆ·ç«¯
{
  type: "message" | "tool_call" | "tool_result" | "error",
  content: string,
  metadata?: {
    toolName?: string,
    toolArgs?: any,
    skillId?: string
  }
}
```

## é¢„æœŸæˆæœ
- å®Œæ•´çš„ Web ç•Œé¢ï¼Œå¯é€šè¿‡æµè§ˆå™¨è®¿é—®
- æ”¯æŒä¸ Agent å®æ—¶å¯¹è¯
- å¯è§†åŒ–å±•ç¤ºå·¥å…·è°ƒç”¨è¿‡ç¨‹
- ç®¡ç†å’ŒæŸ¥çœ‹æŠ€èƒ½çŠ¶æ€
- å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨ç«¯
