# Task: Tools API Key 管理系统

**任务ID**: task_tools_key_260206_142543
**创建时间**: 2026-02-06 14:25:43
**状态**: 进行中

## 最终目标
为需要API key的工具提供在UI界面中配置和存储key的功能,使用浏览器localStorage进行持久化存储。

## 拆解步骤

### 1. 分析工具系统,识别需要API key的工具
- [ ] 查找tools相关代码和配置
- [ ] 识别哪些工具需要API key
- [ ] 整理工具列表及其需要的key类型

### 2. 设计数据结构
- [ ] 设计localStorage存储结构
- [ ] 设计API key配置接口

### 3. 实现前端UI组件
- [ ] 在item中预留API key输入位置
- [ ] 创建API key管理界面
- [ ] 实现localStorage读写功能

### 4. 集成到工具调用流程
- [ ] 修改工具调用逻辑,从localStorage读取key
- [ ] 添加key验证和错误处理

## 当前进度

### 正在进行
功能已完成并重新构建

### 已完成
1. ✅ 分析了工具系统代码
2. ✅ 识别了需要API key的工具:
   - **web_search**: 需要 `BRAVE_API_KEY` 或 `SEARCH_API_KEY`

3. ✅ 创建了 localStorage 管理工具 (`/Users/zack/Desktop/Krebs/ui/src/ui/utils/storage.ts`)

4. ✅ 在工具列表中直接添加 API Key 输入框:
   - 修改 `krebs-tools-panel.ts` - 工具面板页面，每个工具卡片中有 API Key 输入
   - 修改 `krebs-tools-list.ts` - 侧边栏工具列表，每个工具项中有 API Key 输入
   - 删除 `krebs-api-key-manager.ts` - 不需要独立的管理页面

5. ✅ 实现了后端 API Key 管理:
   - 创建 `/Users/zack/Desktop/Krebs/src/shared/api-keys.ts` - 全局 API Key 管理器
   - 修改 `web.ts` - 支持从客户端获取 API Key
   - 修改 `http-server.ts` - 添加 `/api/tools/keys` 端点

6. ✅ 构建验证:
   - 后端构建成功 ✅
   - 前端构建成功 ✅ (134.62 KB)

## 实现效果

### 用户体验
1. 打开工具面板或侧边栏
2. 看到 `web_search` 工具有 🔑 或 ⚠️ 图标提示
3. 直接在工具卡片下方输入 API Key
4. 点击"保存"按钮
5. API Key 自动保存到 localStorage 并发送给后端
6. 图标变为 ✓ 表示已配置

### 技术实现
- 前端：在工具列表/卡片中集成输入框
- 后端：接收并存储到内存中
- 工具执行：优先使用客户端提供的 Key

## 下一步行动
任务已完成，可以启动服务测试功能
